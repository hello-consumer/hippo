<html>
<head>
	<title>HIPPO</title>
<!-- 	<link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap-theme.min.css" />
	<link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.min.css" /> -->
	<link href='http://fonts.googleapis.com/css?family=Raleway:600,400,300' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" href="skeleton/css/normalize.css" />
	<link rel="stylesheet" type="text/css" href="skeleton/css/skeleton.css" />
	<link rel="stylesheet" type="text/css" href="hippo.css" />
	<script src="js/jquery-1.11.2.min.js"></script>
	<script src="js/jquery-ui-1.11.4.min.js"></script>
	<script src="bootstrap/js/bootstrap.min.js"></script>
	<script src="hippo.js"></script>
	<script src="levenshtein.js"></script>
	<script>
	  // Harmony Button
	  $(function() {
	    $( "#harmony" )
	      .click(function( event ) {
	      	// event
	      });
	  });

	  // Utility
	  function float_round(num, float_cnt) {
	  	if (float_cnt < 1) {
	  		return Math.floor(num);
	  	}
	  	var tmp = num * Math.pow(10, float_cnt);
	  	tmp = Math.floor(tmp);
	  	return tmp / Math.pow(10, float_cnt);
	  }

	  function valid_item(item_name) {
	  	if (jQuery.inArray(item_name, hippo_item_list) == -1) {
	  		return false;
	  	} else {
	  		return true;
	  	}
	  }

	  function get_added_items() {
	  	var items = $(".added_item");
	  	var arr = new Array();
	  	for (var i = 0; i < items.length; i++) {
	  		arr.push(items[i].innerText);
	  	}
	  	return arr;
	  }

	  function remove_item(item) {
	  	item.remove();
	  	reload_score();
	  }

	  function add_item(item_name) {
	  	if (jQuery.inArray(item_name, get_added_items()) != -1) {
	  		return;
	  	}
	  	var item = $("<button class='added_item'>");
	  	item.text(item_name);
	  	item.click(function(event){remove_item(this)});
	  	$( "#items" ).append(item);
	  }

	  // Cal
	  function get_score(items) {
	  	if (items.length < 2) {
	  		return {item_list:[], avg:0, sd:0};
	  	}
	  	var index_list = new Array();
	  	for (var i = 0; i < items.length; i++) {
	  		index_list.push(hippo_item_list.indexOf(items[i]));
	  	}
	  	var dst_list = new Array();
	  	for (var i = 0; i < index_list.length; i++) {
	  		for (var k = i+1; k < index_list.length; k++) {
	  			dst_list.push(hippo_item_matrix[i][k]);
	  		}
	  	}
	  	var avg = 0;
	  	var sd = 0;
	  	for (var i = 0; i < dst_list.length; i++) {
	  		avg += dst_list[i];
	  		for (var k = i+1; k < dst_list.length; k++) {
	  			sd += Math.abs(dst_list[i] - dst_list[k]);
	  		}
	  	}
	  	var score = new Object();
	  	score.item_list = items;
	  	score.avg = avg / dst_list.length;
	  	score.sd = sd / dst_list.length;
	  	return score;
	  }

	  function reload_score() {
	  	var items = get_added_items();
	  	var score = get_score(items);
	  	var harmony = score.avg == 0 ? 0 : 100 - score.avg;
	  	var novelty = score.sd == 0 ? 0 : score.sd * 100;
	  	harmony = float_round(harmony, 0);
	  	novelty = float_round(novelty, 0);
	  	$('#novelty_score').text(novelty);
	  	$('#harmony_score').text(harmony);
	  	$('#sum_score').text(novelty + harmony);
	  }
	  
	  //item list
	  function reload_list() {
	  	var input_text = $("#item_input").val();
	  	var tbody = $("#item_list");
	  	tbody.empty();
	  	for (var i = 0; i < hippo_item_list.length; i++) {
	  		var tr = $("<tr>");
	  		var id_td = $("<td>");
	  		var item_td = $("<td>");
	  		var dst_td = $("<td>");
	  		id_td.text(i);
	  		item_td.text(hippo_item_list[i]);
	  		dst_td.text(Levenshtein(input_text, hippo_item_list[i]));
	  		tr.append(id_td);
	  		tr.append(item_td);
	  		tr.append(dst_td);
	  		tbody.append(tr);
	  	}
	  }

	  // Ajax input
	  $(function() {
	  	$( "#item_input" ).keypress(
	  		function(e){
	  			if(e.which == 13) {
	  				if(valid_item(this.value)) {
		  				add_item(this.value);
		  				reload_score();
		  				this.value = '';
		  			}
	  			}
	  		}
	  	);
	  });

	  $(function() {
	  	$( "#item_input" ).keyup(
	  		function(e){
		  		reload_list();
	  		}
	  	);
	  });

	  // Auto Complete
	  $(function() {
	    var availableTags = [
	      "PHP",
	      "Python",
	      "Ruby",
	      "Scala",
	      "Scheme"
	    ];
	    $( "#item_input" ).my_autocomplete({
	      source: availableTags
	    });
	  });

	</script>
</head>
<body>
	<div class='main container'>
		<div class='header'>
			<span class='header_title'>
				<img src="imgs/default/lab.png"/>
				<h5>HIPPO v0.01</h5>
			</span>
			<span class='header_subtitle'>
				HIPPO is a creative playground where you can try new item parings with computer supported adjustment
			</span>
		</div>
		<div class='row'>
			<div class='two columns'>
				<table>
					<thread>
						<tr>
							<th>ID</th>
							<th>Item</th>
							<th>hoge</th>
						</tr>
					</thread>
					<tbody id='item_list'>
						<tr>
							<td>3</td>
							<td>chocolate</td>
							<td>32</td>
						</tr>
						<tr>
							<td>3</td>
							<td>chocolate</td>
							<td>32</td>
						</tr>
						<tr>
							<td>3</td>
							<td>chocolate</td>
							<td>32</td>
						</tr>
						<tr>
							<td>3</td>
							<td>chocolate</td>
							<td>32</td>
						</tr>
						<tr>
							<td>3</td>
							<td>chocolate</td>
							<td>32</td>
						</tr>
						<tr>
							<td>3</td>
							<td>chocolate</td>
							<td>32</td>
						</tr>
						<tr>
							<td>3</td>
							<td>chocolate</td>
							<td>32</td>
						</tr>
						<tr>
							<td>3</td>
							<td>chocolate</td>
							<td>32</td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class='ten columns'>
				<div class='console'>
					<div class='input'>
						<input placeholder='chocolate' id="item_input" type="email">
					</div>
					<div class='harmony_button'>
						<button class='button button-primary' id='harmony'>HARMONIZE</button>
					</div>
					<div class='items' id='items'>
					</div>
					<hr>
					<div class='container'>
						<div class='score row'>
							<div class='novelty_column four columns'>
								<label>NOVELTY</label>
								<h1 id='novelty_score'>0.0</h1>
							</div>
							<div class='harmony_column four columns'>
								<label>HARMONY</label>
								<h1 id='harmony_score'>0.0</h1>
							</div>
							<div class='sum_column four columns'>
								<label>SUM</label>
								<h1 id='sum_score'>0.0</h1>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<hr class='footer_hr'>
		<div class='footer'>
			&copy; Yui Kita 2015
		</div>
	</div>
</body>
</html>